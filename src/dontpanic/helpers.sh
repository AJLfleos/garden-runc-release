function hastput {
  command -v tput > /dev/null
}

printSection() {
  termwidth=80
  if hastput; then
    termwidth="$(tput cols)"
  fi
  padding="$(printf '%0.1s' -{1..500})"
  echo -e "${blue}"
  leftmargin=3
  msgwidth="${#1}"
  rightmargin="$(($termwidth-$leftmargin-msgwidth-2))"
  printf '%*.*s[%s]%*.*s\n' 0 "$leftmargin" "$padding" "$1" 0 "$rightmargin" "$padding"
  echo -e "${white}"
}


function printAndCollect() {
  printSection "Collecting $1"
  /bin/sh -c "$2" > >(tee -a "$3") 2> >(tee -a "$3" >&2)
  if [ $? -ne 0 ]; then
    printFailed
  fi
}

function collect() {
  printSection "Adding $1 to OS Report Archive"
  /bin/sh -c "$2" > "$3" 2> "$3"
  if [ $? -ne 0 ]; then
    printFailed
  fi
}

function archive {
  printSection "Adding $1 to OS Report Archive"
  tar czf "$3.tgz" -C "$2" "$3"
  if [ $? -ne 0 ]; then
    printFailed
  fi
}

function archiveDir {
  printSection "Archiving $1"
  tar czf "$3" -C "$2" .
  if [ $? -ne 0 ]; then
    printFailed
  fi
}

function printFailed() {
  echo -e "${red}Failed${white}"
}

function printBanner {
  echo -e "${yellow}"
  cat <<-END
====+===.,=======+:+777 ...                                        7777.+====~I7
....:=+==========.?7 77...               THIS IS                    777,,====~I7
================.7  7 ..                                              77.===:,?7
================.7  7...  _______   ____  ____   ____ _______         77.==:=~?7
=====~====~=::~~,7  ...    ||    \   ||    ||\    ||  ||     \        77.=~~~~?7
==+===~======~==.7  ..     ||__,     ||    || \\\\  ||  ||__,           77.=~~~~?7
+=.=============.7   ...   ||        ||    ||   \\\\||  ||             77+.====~?7
======:......:===.77  ..  _||_      _||_  _||_   \||_ ||_____/     7777..:~::,I7
====~:~====?=~==+=.7777 .                                            7:==+===~?7
===+++==++++===+=:=..77                                         77777.?I+=====?7
+=+++++++++,????+++==..=777 77                              777777I.,++?+++==~I7
....,.....+7......??=+++=...:?I7777777777777777777777777777 7I...,++.=+++++===I7
I?IIII?IIII,?++++++.+......,I7IIIII7I???,777I..........,,~++++==+++=+~.,......I7
IIIIIIIIII.+++++++++.III??II?I???III?I??,777,7IIII?IIII7..~???++=,.,.=I?I+????77
I?I??IIIII.++++++++++.I,.+7II??IIIII????.777.IIIIIII???III7777II+I7IIII?+?,?I?77
????IIIIII,++++++,..,.,?+?.I?IIIIIIIIIII.777.IIIIIIII??I??IIII???IIIIIII.??+?+77
I.~?IIIIII.++,......,+++++=+IIIIIIIIIII7.77=+IIIIIII?II?IIIIIIIIIII?I??,???=~+77
.=??IIIII,....,...,+++++++.IIIIIIIIIIII~:77.IIIIIIIIIIIIIIIIII?II?????+???++?,77
?,+II7,I?++++++=~++++++++:.=I7IIIIIIIII.I7.II?IIIIII?III7IIIIIIIIIII?,+?????7I77
?.?III+.+=++++++++++++?..I+++,IIIIIIII7,7.IIIIIIIIIIIIII~.IIIIIIII?+.????+?77I77
?.??.I?.+++=.:+?++=.,.++++++++..IIIIII=I.IIIIIIIII?IIII?.+??II?III.+???????:I+I7
?:?I??=+,.?~?+++++=++++++++=++?I:IIIII..7IIIIIIII?IIIII+??+?IIII:~+???+???+??+I7
??+.??~??7?,=+++++===+??+++++:7777?.7IIIIIIIIIIIIIIIII=???,II?::?+??I????:???+I7
?+..+,?~??.+=++++,.....?++=+777?.,,,.IIIIIIIIIIIIIIII?????.II.?????I?,??,????~77
++?+:+??,..=++=.77777777.++777.,,..,,=IIIIIIIIIIIIII=I????.?+???????+.???????I77
?+++++=,....++?7777:.,,77:.777..,,,,..IIIIIIIII....77II,??,.+????.?+?+?????II?77
??=?+,..,...++.777..,.,..7.77?..,,,,,,IIIII?,,.,,,.,.I????????++?????????????+77
+:??..,.,...++?777,.,.,..7.777,,,,,,,7~..~~...,,,,.,..????????,????????????:?+77
+++,........+?+777,.,,,.,,.?77...,,=,=+++,....,,,,....+?.????=+???????????????77
??,...,.....++.777..,.,..?.I,~7777,:+++++.....,,,...,????:????I?????????=?++??77
??..........++++777,......++++?~:+++++++,..........,I??????,II??????????+?????77
?:,..,......+++?.=77I77..++++=++=++++++=+..........,?????II??????????????,????77
?.......,...+++++++:,~+++++++==++++++=+++:......~+I:???????????II?????+???????77
?..,........++=+++++++====+=+=++=++++=++===++++++?,?+?????????I???I???++:?????77
+~..........+++++++=+==:.7..++++=+++++=+++++++++.:??????????I???I????????????+77
?I.,.......+=+===++++=.++?77:..,+++++++=++?+,..?I???+?=??????????????????+????77
~.....,...+==+===+=++=+~~===.:77.7,...,,~I+???I??????????????????????????+???+77
++.I?=,=~==+====++=++=++=,=+......:?IIII7.???I???????I????????????+????+++??+?77
=,+++=+:+=====+=+==+====++:.,.,...+=??IIII??=????????=??????=~?+??I?I?I7I.7?I?77
+.+=+=+.===+==,=+===+=======++=++++=?,II,??????????????:?????I7.........,,+I.I77
+.++++.====+=~.=============+===,.+I+II.I?+.??????+?~????????IIIIIIIIIIII?,??=77
+.++++.++=.===.==============+===+.??+:.???+??????++?+,+??????IIIIIIIIIIII,.I?77
~.+++=+=+=.===.============+======+.~????+???+???+????+??????.IIIIIIIIIII=.I??77
,.+?+.++++.===.===================+.++????~????????+??++?????.IIIIIII??II,~:.,77
,.+++.++++.+=+.+===================.++,??,?+++++++?+++??????7,I?????????I.....77
,.?++.++++.+++.++==================.+?+++??+++++++++++?I?+:,..~?IIIIII?II.++++I7
,:+++~~+++,,=++:=+=++====+=========.+++?++++++++++++=~.,?+++?+???I?I?+???+++++I7
,:++++.==+?.+=+.+=+=+=+==+=======+=.??+++++++++++??..+=+++++++++++++++++++++++I7
+~++++.+=++:++=+.=+======+=+=+==++.?I?++++++++++++=:+.+=++++++++++++=++++=+=++I7
END
  echo -e "${white}"
}

# no colours by default
bold=""
underline=""
standout=""
normal=""
black=""
red=""
green=""
yellow=""
blue=""
magenta=""
cyan=""
white=""
# check if stdout is a terminal...
if test -t 1; then
  if hastput; then

    # see if it supports colors...
    ncolors=$(tput colors)

    if test -n "$ncolors" && test $ncolors -ge 8; then
        bold="$(tput bold)"
        underline="$(tput smul)"
        standout="$(tput smso)"
        normal="$(tput sgr0)"
        black="$(tput setaf 0)"
        red="$(tput setaf 1)"
        green="$(tput setaf 2)"
        yellow="$(tput setaf 3)"
        blue="$(tput setaf 4)"
        magenta="$(tput setaf 5)"
        cyan="$(tput setaf 6)"
        white="$(tput setaf 7)"
    fi
  fi
fi
