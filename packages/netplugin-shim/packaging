#!/usr/bin/env bash
set -euo pipefail

# These need to be defined since bosh compilation VMs don't set $HOME
export GOCACHE=/tmp/gocache
export GOPATH=/tmp/gopath

export GOROOT; GOROOT="$( readlink -nf /var/vcap/packages/golang )"
export PATH="${GOROOT}/bin:${PATH}"

cd ./code.cloudfoundry.org/netplugin-shim

go build -mod vendor -o "${BOSH_INSTALL_TARGET}/bin/garden-plugin" ./garden-plugin
go build -mod vendor -o "${BOSH_INSTALL_TARGET}/bin/netplugin-server" ./netplugin-server
